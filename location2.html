<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location 2</title>
    <link rel="stylesheet" href="./location2.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
</head>

<body>
    <script type = "text/javascript">
        var s1topic1=  "slot002/cabi001/loc001ker/sta001tus";
        var s1topic2=  "slot002/cabi002/loc002ker/sta002tus";
        var s1topic3=  "slot002/cabi003/loc003ker/sta003tus";
        var s1topic4=  "slot002/cabi004/loc004ker/sta004tus";
        var s1topic5=  "slot002/cabi005/loc005ker/sta005tus";
        var s1topic6=  "slot002/cabi006/loc006ker/sta006tus";
        var s1topic7=  "slot002/cabi007/loc007ker/sta007tus";
        var s1topic8=  "slot002/cabi008/loc008ker/sta008tus";
        var s1topic9=  "slot002/cabi009/loc009ker/sta009tus";
        var s1topic10=  "slot002/cabi0010/loc0010ker/sta0010tus";
        var s1topic11=  "slot002/cabi0011/loc0011ker/sta0011tus";
        var s1topic12=  "slot002/cabi0012/loc0012ker/sta0012tus";
        var s1topic13=  "slot002/cabi0013/loc0013ker/sta0013tus";
        var s1topic14=  "slot002/cabi0014/loc0014ker/sta0014tus";
        var s1topic15=  "slot002/cabi0015/loc0015ker/sta0015tus";
        var s1topic16=  "slot002/cabi0016/loc0016ker/sta0016tus";
        
        function onConnectionLost(){
        console.log("connection lost");
        
        connected_flag=0;
        }
        function onFailure(message) {
            console.log("Failed");
            setTimeout(MQTTconnect, reconnectTimeout);
            }
        function onMessageArrived(r_message){
            out_msg="Message received "+r_message.payloadString;
            out_msg=out_msg+"      Topic "+r_message.destinationName +"<br/>";
            out_msg="<b>"+out_msg+"</b>";
            //console.log(out_msg+row);
            try{
         
      
                if(r_message.destinationName==s1topic1){
                    changeOccupancyStatus(1, parseInt(r_message.payloadString));
                }
                
                
                if(r_message.destinationName==s1topic2){
                    changeOccupancyStatus(2, parseInt(r_message.payloadString));
                }
             
                
                
                if((r_message.destinationName==s1topic3) ){
                    changeOccupancyStatus(3, parseInt(r_message.payloadString));
                }
             
                
                if((r_message.destinationName==s1topic4) ){
                    changeOccupancyStatus(4,parseInt(r_message.payloadString));
                }
            
    
                if((r_message.destinationName==s1topic5) ){
                    changeOccupancyStatus(5,parseInt(r_message.payloadString));
                }
               
                
                
                if((r_message.destinationName==s1topic6) ){
                    changeOccupancyStatus(6,parseInt(r_message.payloadString));
                }
                
                
                
                
                if((r_message.destinationName==s1topic7) ){
                    changeOccupancyStatus(7, parseInt(r_message.payloadString));
                }
                
                
                
                
                if((r_message.destinationName==s1topic8) ){
                    changeOccupancyStatus(8, parseInt(r_message.payloadString));
                }
                
                
                
                
                if((r_message.destinationName==s1topic9) ){
                    changeOccupancyStatus(9, parseInt(r_message.payloadString));
                }
                
                
                
                if((r_message.destinationName==s1topic10) ){
                    changeOccupancyStatus(10, parseInt(r_message.payloadString));
                }
                
                
                if((r_message.destinationName==s1topic11) ){
                    changeOccupancyStatus(11, parseInt(r_message.payloadString));
                }
                
                
                
                if((r_message.destinationName==s1topic12) ){
                    changeOccupancyStatus(12,parseInt(r_message.payloadString));
                }
               
                
                
                if((r_message.destinationName==s1topic13) ){
                    changeOccupancyStatus(13, parseInt(r_message.payloadString));
                }
                
                
                
                if((r_message.destinationName==s1topic14) ){
                    changeOccupancyStatus(14, parseInt(r_message.payloadString));
                }
                
                if((r_message.destinationName==s1topic15) ){
                    changeOccupancyStatus(15, parseInt(r_message.payloadString));
                }
                if((r_message.destinationName==s1topic16) ){
                    changeOccupancyStatus(16, parseInt(r_message.payloadString));
                }
                
            }
            catch(err){
            //document.getElementById("out_messages").innerHTML=err.message;
            }
        
                
            mcount+=1;
            console.log(mcount+"  "+row);
            }
            
        function onConnected(recon,url){
        console.log(" in onConnected " +reconn);
        }
        function onConnect() {
          // Once a connection has been made, make a subscription and send a message.
        //document.getElementById("status_messages").innerHTML ="Connected to "+host +"on port "+port;
        connected_flag=1;
        //  document.getElementById("status").innerHTML = "";
        console.log("on Connect "+connected_flag);
        sub_topics();
    
          }
          function disconnect()
          {
            if (connected_flag==1)
                mqtt.disconnect();
          }
    
        function MQTTconnect() {
        var clean_sessions=true;
        var user_name="emqx";
        console.log("clean= "+clean_sessions);
        var password="public";
        
        
    
        //document.getElementById("status_messages").innerHTML ="";
        var s ="broker.emqx.io";
        var p =8083;
        if (p!="")
        {
            port=parseInt(p);
            }
        if (s!="")
        {
            host=s;
            console.log("host");
            }
    
        console.log("connecting to "+ host +" "+ port +"clean session="+clean_sessions);
        console.log("user "+user_name);
        var x=Math.floor(Math.random() * 10000); 
        var cname="orderform-"+x;
        mqtt = new Paho.MQTT.Client(host,port,cname);
        //document.write("connecting to "+ host);
        var options = {
            //useSSL:true,
            timeout: 3,
            cleanSession: clean_sessions,
            onSuccess: onConnect,
            onFailure: onFailure,
          
         };
        
            options.userName=user_name;
        
            options.password=password;
        
            mqtt.onConnectionLost = onConnectionLost;
            mqtt.onMessageArrived = onMessageArrived;
            mqtt.onConnected = onConnected;
    
        mqtt.connect(options);
        return false;
      
     
        }
        function sub_topics(){
            //document.getElementById("status_messages").innerHTML ="";
            if (connected_flag==0){
            out_msg="<b>Not Connected so can't subscribe</b>"
            console.log(out_msg);
            document.getElementById("s").innerHTML = out_msg;
            return false;
            }
    
        
        
        //var s1topic= document.forms["subs"]["s1topic"].value;
        console.log("here");
        var sqos=0;
        if (sqos>2)
            sqos=0;

        
        console.log("Subscribing to topic ="+s1topic1 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic2 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic3 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic4 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic5 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic6 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic7 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic8 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic9 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic10 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic11 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic12 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic13 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic14 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic15 +" QOS " +sqos);
        console.log("Subscribing to topic ="+s1topic16 +" QOS " +sqos);

    
        
        
        
        var soptions={
        qos:sqos,
        };
 
        mqtt.subscribe(s1topic1,soptions);
        mqtt.subscribe(s1topic2,soptions);
        mqtt.subscribe(s1topic3,soptions);
        mqtt.subscribe(s1topic4,soptions);
        mqtt.subscribe(s1topic5,soptions);
        mqtt.subscribe(s1topic6,soptions);
        mqtt.subscribe(s1topic7,soptions);
        mqtt.subscribe(s1topic8,soptions);
        mqtt.subscribe(s1topic9,soptions);
        mqtt.subscribe(s1topic10,soptions);
        mqtt.subscribe(s1topic11,soptions);
        mqtt.subscribe(s1topic12,soptions);
        mqtt.subscribe(s1topic13,soptions);
        mqtt.subscribe(s1topic14,soptions);
        mqtt.subscribe(s1topic15,soptions);
        mqtt.subscribe(s1topic16,soptions);
    
        
        return false;
        }
        
        function send_message(topi,message){
            //document.getElementById("status_messages").innerHTML ="";
            if (connected_flag==0){
            out_msg="<b>Not Connected so can't send</b>"
            console.log(out_msg);
            //document.getElementById("status_messages").innerHTML = out_msg;
            return false;
            }
            var pqos=0;
            if (pqos>2)
                pqos=0;
            var msg = message;
            console.log(msg);
            //document.getElementById("status_messages").innerHTML="Sending message  "+msg;
            var topic = topi;
    
            retain_flag=false;
            message = new Paho.MQTT.Message(msg);
            if (topic=="")
                message.destinationName = "test-topic";
            else
                message.destinationName = topic;
            message.qos=pqos;
            message.retained=retain_flag;
            mqtt.send(message);
            return false;
        }
    
        
        </script>
   
        
    
    <section class='FlexContainer' id="parkingSlots">
        <div class="slot" id="slot17">
            <h3>Parking Slot 1 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot18">
            <h3>Parking Slot 2 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot19">
            <h3>Parking Slot 3 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot20">
            <h3>Parking Slot 4 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot21">
            <h3>Parking Slot 5 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot22">
            <h3>Parking Slot 6 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot23">
            <h3>Parking Slot 7 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot24">
            <h3>Parking Slot 8 (Unoccupied)</h3>
        </div>
    </section>
    <!-- <div class="road">
        <div class="line"></div>
        <div class="line1"></div>
        <div class="line2"></div>
    </div> -->
    <section class='FlexContainer'>
        <div class="slot" id="slot25">
            <h3>Parking Slot 9 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot26">
            <h3>Parking Slot 10 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot27">
            <h3>Parking Slot 11 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot28">
            <h3>Parking Slot 12 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot29">
            <h3>Parking Slot 13 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot30">
            <h3>Parking Slot 14 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot31">
            <h3>Parking Slot 15 (Unoccupied)</h3>
        </div>
        <div class="slot" id="slot32">
            <h3>Parking Slot 16 (Unoccupied)</h3>
        </div>
    </section>
    <div class="contenttable">
        <h2 id="totalSlots1">Total Slots: 16</h2>
        <h2 id="occupiedSlots1">Occupied Slots: 0</h2>
        <h2 id="unoccupiedSlots1">Unoccupied Slots: 16</h2>
    </div>

    

 <script>
        const totalSlots = 16;
        let occupiedSlots = 0;
        const data1 =
            function handleSlotChange() {
                const selectedSlot = document.getElementById('slotList').value;
                console.log(selectedSlot, "jyuf")
                const value = confirm('Is the selected slot occupied?') ? 1 : 0;
                changeOccupancyStatus(selectedSlot, value);
            }

        function changeOccupancyStatus(slotNumber, value) {
            const slot = document.getElementById('slot' + slotNumber);
            if (value === 1) {
                if (!slot.classList.contains('occupied')) {
                    occupiedSlots++;
                }
                slot.innerHTML = '<h3>Parking Slot ' + slotNumber + ' (Occupied)</h3>';
                slot.classList.remove('unoccupied');
                slot.classList.add('occupied');
            } else if (value === 0) {
                if (slot.classList.contains('occupied')) {
                    occupiedSlots--;
                }
                slot.innerHTML = '<h3>Parking Slot ' + slotNumber + ' (Unoccupied)</h3>';
                slot.classList.remove('occupied');
                slot.classList.add('unoccupied');
            } else {
                console.error('Invalid value for occupancy status');
            }
            document.getElementById('totalSlots1').textContent = 'Total Slots: ' + totalSlots;
            document.getElementById('occupiedSlots1').textContent = 'Occupied Slots: ' + occupiedSlots;
            document.getElementById('unoccupiedSlots1').textContent = 'Unoccupied Slots: ' + (totalSlots - occupiedSlots);
        }

        // Example usage for slot occupancy statuses, you can adjust these as needed
        changeOccupancyStatus(1, 0);
        changeOccupancyStatus(2, 0);
        changeOccupancyStatus(3, 0);
        changeOccupancyStatus(4, 0);
        changeOccupancyStatus(5, 0);
        changeOccupancyStatus(6, 0);
        changeOccupancyStatus(7, 0);
        changeOccupancyStatus(8, 0);
        changeOccupancyStatus(9, 0);
        changeOccupancyStatus(10, 0);
        changeOccupancyStatus(11, 0);
        changeOccupancyStatus(12, 0);
        changeOccupancyStatus(13, 0);
        changeOccupancyStatus(14, 0);
        changeOccupancyStatus(15, 0);
        changeOccupancyStatus(16, 0);
    </script> 
    <script>
        var connected_flag=0
        var mqtt;
        var reconnectTimeout = 2;
      
        var row=0;
        var out_msg="";
        var mcount=0;
        var clean_sessions=true;
        var user_name="emqx";
        console.log("clean= "+clean_sessions);
        var password="public";
      
      
      
      
        var s ="broker.emqx.io";
        var p =8083;
        if (p!="")
        {
          port=parseInt(p);
          }
        if (s!="")
        {
          host=s;
          console.log("host");
          }
      
        console.log("connecting to "+ host +" "+ port +"clean session="+clean_sessions);
        console.log("user "+user_name);
        
        var x=Math.floor(Math.random() * 10000);
        var cname="orderform-"+x;
        mqtt = new Paho.MQTT.Client(host,port,cname);
        //document.write("connecting to "+ host);
        var options = {
            //useSSL:true,
              timeout: 3,
          cleanSession: clean_sessions,
          onSuccess: onConnect,
          onFailure: onFailure,
      
           };
      
            options.userName=user_name;
      
          options.password=password;
      
              mqtt.onConnectionLost = onConnectionLost;
              mqtt.onMessageArrived = onMessageArrived;
          mqtt.onConnected = onConnected;
      
        mqtt.connect(options);
        console.log("loc2")
        </script>	
  



</body>

</html>